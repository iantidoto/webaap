<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Gestor Profesional TIC</title>
  <style>
    body { font-family: sans-serif; margin: 20px; background: #f4f4f4; }
    h1 { color: #2a5298; }
    section { background: #fff; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    input, select, button { margin: 5px; padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
    ul { list-style: none; padding: 0; }
    li { margin: 5px 0; }
    button { cursor: pointer; background: #2a5298; color: white; border: none; }
    button:hover { background: #1e3c72; }
    .inline { display: inline-block; }
  </style>
</head>
<body>
  <h1>ğŸ“ğŸ’» Gestor Profesional TIC</h1>

  <section>
    <h2>ğŸ“ Proyectos</h2>
    <input id="nuevoProyecto" placeholder="Nuevo proyecto" />
    <button onclick="agregarProyecto()">â• AÃ±adir</button>
    <select id="selectorProyecto" onchange="mostrarTareasProyecto()">
      <option disabled selected>Selecciona un proyecto</option>
    </select>
    <ul id="listaProyectos"></ul>
  </section>

  <section>
    <h2>âœ… Tareas del proyecto activo</h2>
    <input id="nuevaTarea" placeholder="Nueva tarea" />
    <button onclick="agregarTarea()">â• AÃ±adir</button>
    <ul id="listaTareas"></ul>
  </section>

  <section>
    <h2>ğŸ“… Horarios</h2>
    <input id="nuevoHorario" placeholder="Nuevo horario" />
    <button onclick="agregarHorario()">â• AÃ±adir</button>
    <ul id="listaHorarios"></ul>
  </section>

  <section>
    <h2>ğŸ—“ï¸ Agenda</h2>
    <input id="nuevoEvento" placeholder="Evento" />
    <input type="datetime-local" id="fechaEvento" />
    <button onclick="agregarEvento()">â• AÃ±adir</button>
    <ul id="listaAgenda"></ul>
  </section>

  <section>
    <h2>ğŸ“Š EstadÃ­sticas</h2>
    <p id="estadisticas"></p>
  </section>

  <script>
    let proyectos = {};
    let agenda = [];

    function actualizarEstadisticas() {
      const totalProyectos = Object.keys(proyectos).length;
      const totalTareas = Object.values(proyectos).reduce((acc, tareas) => acc + tareas.length, 0);
      const totalHorarios = document.querySelectorAll("#listaHorarios li").length;
      const totalEventos = agenda.length;
      document.getElementById("estadisticas").textContent =
        `Proyectos: ${totalProyectos}, Tareas: ${totalTareas}, Horarios: ${totalHorarios}, Eventos: ${totalEventos}`;
    }

    function crearElemento(texto, editarCallback, eliminarCallback) {
      const li = document.createElement("li");
      const span = document.createElement("span");
      span.textContent = texto;

      const editarBtn = document.createElement("button");
      editarBtn.textContent = "âœï¸";
      editarBtn.onclick = () => {
        const nuevoTexto = prompt("Editar:", span.textContent);
        if (nuevoTexto !== null) {
          editarCallback(nuevoTexto);
        }
      };

      const eliminarBtn = document.createElement("button");
      eliminarBtn.textContent = "ğŸ—‘ï¸";
      eliminarBtn.onclick = eliminarCallback;

      li.appendChild(span);
      li.appendChild(editarBtn);
      li.appendChild(eliminarBtn);
      return li;
    }

    function agregarProyecto() {
      const input = document.getElementById("nuevoProyecto");
      const nombre = input.value.trim();
      if (nombre && !proyectos[nombre]) {
        proyectos[nombre] = [];
        actualizarSelectorProyectos();
        guardarDatos();
        input.value = "";
        actualizarEstadisticas();
      }
    }

    function mostrarListaProyectos() {
      const lista = document.getElementById("listaProyectos");
      lista.innerHTML = "";
      Object.keys(proyectos).forEach(nombre => {
        const li = crearElemento(
          nombre,
          nuevoNombre => {
            proyectos[nuevoNombre] = proyectos[nombre];
            delete proyectos[nombre];
            actualizarSelectorProyectos();
            mostrarListaProyectos();
            guardarDatos();
          },
          () => {
            delete proyectos[nombre];
            actualizarSelectorProyectos();
            mostrarListaProyectos();
            guardarDatos();
            actualizarEstadisticas();
          }
        );
        lista.appendChild(li);
      });
    }

    function actualizarSelectorProyectos() {
      const selector = document.getElementById("selectorProyecto");
      selector.innerHTML = '<option disabled selected>Selecciona un proyecto</option>';
      Object.keys(proyectos).forEach(nombre => {
        const option = document.createElement("option");
        option.value = nombre;
        option.textContent = nombre;
        selector.appendChild(option);
      });
      mostrarListaProyectos();
    }

    function mostrarTareasProyecto() {
      const proyecto = document.getElementById("selectorProyecto").value;
      const lista = document.getElementById("listaTareas");
      lista.innerHTML = "";
      if (proyectos[proyecto]) {
        proyectos[proyecto].forEach((tarea, i) => {
          const li = crearElemento(
            tarea,
            nuevoTexto => {
              proyectos[proyecto][i] = nuevoTexto;
              guardarDatos();
              mostrarTareasProyecto();
            },
            () => {
              proyectos[proyecto].splice(i, 1);
              guardarDatos();
              mostrarTareasProyecto();
              actualizarEstadisticas();
            }
          );
          lista.appendChild(li);
        });
      }
    }

    function agregarTarea() {
      const input = document.getElementById("nuevaTarea");
      const tarea = input.value.trim();
      const proyecto = document.getElementById("selectorProyecto").value;
      if (tarea && proyecto && proyectos[proyecto]) {
        proyectos[proyecto].push(tarea);
        guardarDatos();
        mostrarTareasProyecto();
        input.value = "";
        actualizarEstadisticas();
      }
    }

    function agregarHorario() {
      const input = document.getElementById("nuevoHorario");
      const texto = input.value.trim();
      if (texto) {
        const li = crearElemento(
          texto,
          nuevoTexto => {
            li.querySelector("span").textContent = nuevoTexto;
            guardarDatos();
          },
          () => {
            li.remove();
            guardarDatos();
            actualizarEstadisticas();
          }
        );
        document.getElementById("listaHorarios").appendChild(li);
        input.value = "";
        guardarDatos();
        actualizarEstadisticas();
      }
    }

    function agregarEvento() {
      const texto = document.getElementById("nuevoEvento").value.trim();
      const fecha = document.getElementById("fechaEvento").value;
      if (texto && fecha) {
        agenda.push({ texto, fecha });
        guardarDatos();
        mostrarAgenda();
        document.getElementById("nuevoEvento").value = "";
        document.getElementById("fechaEvento").value = "";
        actualizarEstadisticas();
      }
    }

    function mostrarAgenda() {
      const lista = document.getElementById("listaAgenda");
      lista.innerHTML = "";
      agenda
        .sort((a, b) => new Date(a.fecha) - new Date(b.fecha))
        .forEach((evento, i) => {
          const li = crearElemento(
            `${evento.texto} â€“ ${new Date(evento.fecha).toLocaleString()}`,
            nuevoTexto => {
              const nuevaFecha = prompt("Nueva fecha (YYYY-MM-DD HH:MM):", evento.fecha);
              if (nuevaFecha) {
                agenda[i] = { texto: nuevoTexto, fecha: nuevaFecha };
                guardarDatos();
                mostrarAgenda();
              }
            },
            () => {
              agenda.splice(i, 1);
              guardarDatos();
              mostrarAgenda();
              actualizarEstadisticas();
            }
          );
          lista.appendChild(li);
        });
    }

    function guardarDatos() {
      localStorage.setItem("proyectosData", JSON.stringify(proyectos));
      localStorage.setItem("agendaData", JSON.stringify(agenda));
      const horarios = Array.from(document.querySelectorAll("#listaHorarios li span")).map(span => span.textContent);
      localStorage.setItem("horariosData", JSON.stringify(horarios));
    }

   function cargarDatos() {
  proyectos = JSON.parse(localStorage.getItem("proyectosData")) || {};
  agenda = JSON.parse(localStorage.getItem("agendaData")) || [];
  const horarios = JSON.parse(localStorage.getItem("horariosData")) || [];

  horarios.forEach(texto => {
    const li = crearElemento(
      texto,
      nuevoTexto => {
        li.querySelector("span").textContent = nuevoTexto;
        guardarDatos();
      },
      () => {
        li.remove();
        guardarDatos();
        actualizarEstadisticas();
      }
    );
    document.getElementById("listaHorarios").appendChild(li);
  });

  actualizarSelectorProyectos();
  mostrarAgenda();
  actualizarEstadisticas();
}

window.onload = cargarDatos;
</script>

<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js")
      .then(() => console.log("âœ… Service Worker registrado"))
      .catch(err => console.error("âŒ Error al registrar SW:", err));
  }
</script>
</body>
</html>

